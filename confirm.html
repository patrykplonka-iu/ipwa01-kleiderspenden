<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bestätigung – Kleiderspende</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Eigenes CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-light">

  <!-- Header (Partial) -->
  <div data-include="partials/header.html"></div>

  <main class="container py-4">
    <div class="row justify-content-center">
      <!-- >>> WICHTIG: wszystko w TEJ samej kolumnie <<< -->
      <div class="col-12 col-md-8 col-lg-6 col-xl-5">

        <!-- Karta z podsumowaniem -->
        <div class="card p-3 form-card">
          <h1 class="h4 mb-3">Bestätigung</h1>
          <p class="mb-3" id="modeBadge"></p>
          <dl class="row mb-0" id="summary"></dl>
        </div>

        <!-- Przyciski: POD kartą, jeden pod drugim, ta sama szerokość -->
        <div class="d-grid mt-3 form-card">
          <a href="index.html" class="btn btn-outline-secondary w-100 mb-2">← Zur Startseite</a>
          <a href="register.html" class="btn btn-outline-secondary w-100 mb-2">Zurück zum Formular</a>
          <button class="btn btn-primary w-100" onclick="window.print()">Drucken</button>
        </div>

        <p class="text-center text-muted small mt-3 mb-0" id="timestamp"></p>
      </div>
    </div>
  </main>

  <!-- Footer (Partial) -->
  <div data-include="partials/footer.html"></div>

  <!-- Skripte -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="js/include.js" defer></script>

  <script>
    (function () {
      const modeBadge = document.getElementById("modeBadge");
      const summary   = document.getElementById("summary");
      const ts        = document.getElementById("timestamp");

      let data = null;
      try { data = JSON.parse(sessionStorage.getItem("donationForm") || "null"); } catch(_) {}

      if (!data) {
        modeBadge.innerHTML = '<span class="badge text-bg-warning">Keine Daten gefunden</span>';
        summary.innerHTML   = '<div class="alert alert-warning mb-0">Bitte füllen Sie zuerst das Formular aus.</div>';
        ts.textContent = "Zeitstempel: " + new Date().toLocaleString("de-DE");
        return;
      }

      // Escape
      const esc = (s) => String(s ?? "").replace(/[&<>"']/g, m => (
        {"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]
      ));

      // Modus
      const isAbholung = data.mode === "abholung";
      modeBadge.innerHTML = isAbholung
        ? '<span class="badge text-bg-info">Modus: Abholung</span>'
        : '<span class="badge text-bg-success">Modus: Übergabe an Geschäftsstelle</span>';

      // Wiersze
      const row = (label, value) => `
        <dt class="col-5 col-sm-4 text-secondary">${esc(label)}</dt>
        <dd class="col-7 col-sm-8 mb-2">${esc(value)}</dd>
      `;

      // Treść
      let html = "";
      html += row("Art der Kleidung", data.clothes);
      html += row("Krisengebiet",    data.region);

      if (isAbholung && data.address) {
        const a = data.address;
        html += row("Straße",  a.street);
        html += row("Haus-Nr.",a.hnr);
        html += row("PLZ",     a.zip);
        html += row("Ort",     a.city);
      } else {
        html += row("Ort", "Geschäftsstelle");
      }
      if (data.officeZipPreview) html += row("PLZ-Hinweis", data.officeZipPreview);

      summary.innerHTML = html;

      const when = data.timestamp ? new Date(data.timestamp) : new Date();
      ts.textContent = "Zeitstempel: " + when.toLocaleString("de-DE");
    })();
  </script>
</body>
</html>
